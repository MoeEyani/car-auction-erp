# ุดุฑุญ ูุธุงู ุงูุตูุงุญูุงุช ูู ูุธุงู ุฅุฏุงุฑุฉ ERP ุจุงููุงูู

## ๐๏ธ **ุงูุจููุฉ ุงูุฃุณุงุณูุฉ ููุธุงู ุงูุตูุงุญูุงุช**

### 1. **ุงูุฌุฏุงูู ุงูุฃุณุงุณูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**

```sql
- permissions (ุงูุตูุงุญูุงุช)
- roles (ุงูุฃุฏูุงุฑ) 
- users (ุงููุณุชุฎุฏููู)
- branches (ุงููุฑูุน)
- role_permissions (ุฑุจุท ุงูุฃุฏูุงุฑ ุจุงูุตูุงุญูุงุช)
- user_permission_overrides (ุชุฌุงูุฒุงุช ุตูุงุญูุงุช ุงููุณุชุฎุฏููู)
```

### 2. **ูููุฐุฌ ุงูุจูุงูุงุช (Schema)**

#### **ุฌุฏูู ุงูุตูุงุญูุงุช (Permissions)**
```typescript
model Permission {
  id          Int      @id @default(autoincrement())
  name        String   @unique // ูุซู: 'view_customers', 'manage_users'
  description String?  // ูุตู ุงูุตูุงุญูุฉ
  module      String   // ุงููุญุฏุฉ: 'Customers', 'Users', 'Accounting'
  
  roles       RolePermission[]
  userOverrides UserPermissionOverride[]
}
```

#### **ุฌุฏูู ุงูุฃุฏูุงุฑ (Roles)**
```typescript
model Role {
  id            Int      @id @default(autoincrement())
  name          String   @unique
  description   String?
  isSystemRole  Boolean  @default(false) // ุญูุงูุฉ ุงูุฃุฏูุงุฑ ุงูุงูุชุฑุงุถูุฉ ูู ุงูุญุฐู
  
  users       User[]
  permissions RolePermission[]
}
```

#### **ุฌุฏูู ุงููุณุชุฎุฏููู (Users)**
```typescript
model User {
  id                Int      @id @default(autoincrement())
  fullName          String
  username          String   @unique
  passwordHash      String
  isActive          Boolean  @default(true)
  
  role       Role?   @relation(fields: [roleId], references: [id])
  roleId     Int?
  branch     Branch? @relation(fields: [branchId], references: [id])
  branchId   Int?
  
  permissionOverrides UserPermissionOverride[]
}
```

#### **ุฑุจุท ุงูุฃุฏูุงุฑ ุจุงูุตูุงุญูุงุช (Role-Permission Junction)**
```typescript
model RolePermission {
  role         Role       @relation(fields: [roleId], references: [id])
  roleId       Int
  permission   Permission @relation(fields: [permissionId], references: [id])
  permissionId Int
  
  @@id([roleId, permissionId]) // ููุชุงุญ ูุฑูุจ
}
```

#### **ุชุฌุงูุฒุงุช ุตูุงุญูุงุช ุงููุณุชุฎุฏููู (User Permission Overrides)**
```typescript
model UserPermissionOverride {
  user         User       @relation(fields: [userId], references: [id])
  userId       Int
  permission   Permission @relation(fields: [permissionId], references: [id])
  permissionId Int
  hasPermission Boolean   // TRUE = ููุญุ FALSE = ููุน
  
  @@id([userId, permissionId])
}
```

---

## ๐ **ุงูุตูุงุญูุงุช ุงูููุฌูุฏุฉ ูู ุงููุธุงู (19 ุตูุงุญูุฉ)**

### **1. ุตูุงุญูุงุช ุฅุฏุงุฑูุฉ ุนุงูุฉ (System Administration) - ูุณุชูู ุงููุฏูุฑ ุงูุนุงู**

| ุงูุตูุงุญูุฉ | ุงููุตู | ุงููุณุชูู |
|---------|-------|---------|
| `system_admin` | ูุตูู ูุงูู ูููุธุงู ุจุฌููุน ุงููุญุฏุงุช ูุงููุฑูุน | ุนุงู |
| `create_global_admin` | ุฅูุดุงุก ุฃุฏูุงุฑ ุฅุฏุงุฑูุฉ ุนุงูุฉ ูุตูุงุญูุงุช ุงููุธุงู | ุนุงู |
| `manage_system_roles` | ุฅุฏุงุฑุฉ ุฃุฏูุงุฑ ุงููุธุงู ุนูู ูุณุชูู ุนุงูู | ุนุงู |

### **2. ุตูุงุญูุงุช ุฅุฏุงุฑุฉ ุงููุฑูุน (Branch Management)**

| ุงูุตูุงุญูุฉ | ุงููุตู | ุงููุณุชูู |
|---------|-------|---------|
| `view_all_branches` | ุนุฑุถ ุฌููุน ุงููุฑูุน ูู ุงููุธุงู | ุนุงู |
| `view_own_branch_only` | ุนุฑุถ ุงููุฑุน ุงููุฎุตุต ูููุณุชุฎุฏู ููุท | ูุฑุน |
| `manage_branches` | ุฅูุดุงุก ูุชุนุฏูู ูุญุฐู ุงููุฑูุน | ุนุงู |
| `view_branches` | ุนุฑุถ ุงููุฑูุน ุงูุนุงูุฉ (ูุฑุงุกุฉ) | ูุชูุณุท |

### **3. ุตูุงุญูุงุช ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู (User Management)**

| ุงูุตูุงุญูุฉ | ุงููุตู | ุงููุณุชูู |
|---------|-------|---------|
| `view_all_users` | ุนุฑุถ ุฌููุน ุงููุณุชุฎุฏููู ูู ูุงูุฉ ุงููุฑูุน | ุนุงู |
| `view_own_branch_users_only` | ุนุฑุถ ูุณุชุฎุฏูู ุงููุฑุน ุงููุฎุตุต ููุท | ูุฑุน |
| `manage_all_users` | ุฅุฏุงุฑุฉ ุฌููุน ุงููุณุชุฎุฏููู ูู ูุงูุฉ ุงููุฑูุน | ุนุงู |
| `manage_own_branch_users_only` | ุฅุฏุงุฑุฉ ูุณุชุฎุฏูู ุงููุฑุน ุงููุฎุตุต ููุท | ูุฑุน |
| `manage_users` | ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ุจุดูู ุนุงู | ูุชูุณุท |
| `view_users` | ุนุฑุถ ุงููุณุชุฎุฏููู (ูุฑุงุกุฉ) | ุฃุณุงุณู |

### **4. ุตูุงุญูุงุช ุฅุฏุงุฑุฉ ุงูุฃุฏูุงุฑ (Role Management)**

| ุงูุตูุงุญูุฉ | ุงููุตู | ุงููุณุชูู |
|---------|-------|---------|
| `view_roles` | ุนุฑุถ ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช | ุฃุณุงุณู |
| `manage_roles` | ุฅูุดุงุก ูุชุนุฏูู ูุชุฎุตูุต ุงูุฃุฏูุงุฑ | ูุชูุณุท |

### **5. ุตูุงุญูุงุช ุฅุฏุงุฑุฉ ุงูุนููุงุก (Customer Management)**

| ุงูุตูุงุญูุฉ | ุงููุตู | ุงููุณุชูู |
|---------|-------|---------|
| `view_customers` | ุนุฑุถ ุจูุงูุงุช ุงูุนููุงุก | ุฃุณุงุณู |
| `manage_customers` | ุฅุฏุงุฑุฉ ุงูุนููุงุก (ุฅุถุงูุฉุ ุชุนุฏููุ ุญุฐู) | ูุชูุณุท |

### **6. ุตูุงุญูุงุช ุฃุณุงุณูุฉ (Basic Permissions)**

| ุงูุตูุงุญูุฉ | ุงููุตู | ุงููุณุชูู |
|---------|-------|---------|
| `view_dashboard` | ุนุฑุถ ููุญุฉ ุงูุชุญูู ุงูุฑุฆูุณูุฉ | ุฃุณุงุณู |
| `change_own_password` | ุชุบููุฑ ูููุฉ ุงููุฑูุฑ ุงูุดุฎุตูุฉ | ุฃุณุงุณู |

### **๐ ุชุตููู ุงูุตูุงุญูุงุช ุญุณุจ ุงููุณุชูู:**

#### **๐ด ุนุงู (Global) - ูุฏูุฑ ุนุงู ููุท (6 ุตูุงุญูุงุช)**
- `system_admin`
- `create_global_admin`
- `manage_system_roles`
- `view_all_branches`
- `manage_all_users`
- `view_all_users`
- `manage_branches`

#### **๐ก ูุชูุณุท (Intermediate) - ูุฏูุฑ ูุฑุน (4 ุตูุงุญูุงุช)**
- `manage_users`
- `manage_roles`
- `manage_customers`
- `view_branches`

#### **๐ข ูุฑุน (Branch) - ูุณุชุฎุฏูู ุงููุฑุน (3 ุตูุงุญูุงุช)**
- `view_own_branch_only`
- `view_own_branch_users_only`
- `manage_own_branch_users_only`

#### **๐ต ุฃุณุงุณู (Basic) - ุฌููุน ุงููุณุชุฎุฏููู (5 ุตูุงุญูุงุช)**
- `view_dashboard`
- `change_own_password`
- `view_roles`
- `view_customers`
- `view_users`

---

## ๐ฅ **ุงูุฃุฏูุงุฑ ุงูููุฌูุฏุฉ ูู ุงููุธุงู**

### **ุงูุฃุฏูุงุฑ ุงููุธุงููุฉ ุงูุฃุณุงุณูุฉ:**

| ุงูุฏูุฑ | ุงููุตู | ููุน ุงูุฏูุฑ | ุงูุตูุงุญูุงุช ุงููุฎุตุตุฉ |
|------|-------|----------|------------------|
| `Super Admin` | ุงููุฏูุฑ ุงูุนุงู ูููุธุงู | ูุธุงูู | ุฌููุน ุงูุตูุงุญูุงุช ุงูู 19 |
| `Admin` | ุงููุฏูุฑ ุงูุฅุฏุงุฑู | ูุธุงูู | ุตูุงุญูุงุช ุฅุฏุงุฑูุฉ ูุชูุฏูุฉ |
| `Branch Manager` | ูุฏูุฑ ุงููุฑุน | ูุธุงูู | ุตูุงุญูุงุช ูุฏูุฑ ุงููุฑุน |
| `User` | ุงููุณุชุฎุฏู ุงูุนุงุฏู | ูุธุงูู | ุตูุงุญูุงุช ุฃุณุงุณูุฉ |

### **ุงูุฃุฏูุงุฑ ุงููุฎุตุตุฉ:**

| ุงูุฏูุฑ | ุงููุตู | ููุน ุงูุฏูุฑ |
|------|-------|----------|
| `ali` | ุฏูุฑ ูุฎุตุต ูููุณุชุฎุฏู ุนูู | ูุฎุตุต |
| `dashboard and see branches and edit them but only see users` | ุฏูุฑ ูุฎุตุต ูููุญุฉ ุงูุชุญูู ูุงููุฑูุน | ูุฎุตุต |
| `not admin` | ุฏูุฑ ุบูุฑ ุฅุฏุงุฑู ูุฎุตุต | ูุฎุตุต |

### **๐ ุชูุฒูุน ุงูุตูุงุญูุงุช ููุฃุฏูุงุฑ ุงููุธุงููุฉ:**

#### **๐ด Super Admin (ุงููุฏูุฑ ุงูุนุงู)**
```
ุฌููุน ุงูุตูุงุญูุงุช ุงูู 19:
โ system_admin
โ create_global_admin  
โ manage_system_roles
โ view_all_branches
โ manage_all_users
โ view_all_users
โ manage_branches
โ view_branches
โ manage_users
โ view_users
โ manage_roles
โ view_roles
โ manage_customers
โ view_customers
โ view_dashboard
โ change_own_password
โ view_own_branch_only
โ view_own_branch_users_only
โ manage_own_branch_users_only
```

#### **๐ก Branch Manager (ูุฏูุฑ ุงููุฑุน)**
```
ุตูุงุญูุงุช ุฅุฏุงุฑุฉ ุงููุฑุน:
โ view_own_branch_only
โ view_own_branch_users_only
โ manage_own_branch_users_only
โ manage_roles (ูุญุฏูุฏ)
โ view_roles
โ view_dashboard
โ change_own_password
โ manage_customers
โ view_customers
โ view_users
```

#### **๐ข User (ุงููุณุชุฎุฏู ุงูุนุงุฏู)**
```
ุงูุตูุงุญูุงุช ุงูุฃุณุงุณูุฉ:
โ view_own_branch_only
โ view_dashboard
โ change_own_password
โ view_customers (ูุฑุงุกุฉ ููุท)
โ view_users (ูุฑุงุกุฉ ููุท)
โ view_roles (ูุฑุงุกุฉ ููุท)
```

#### **๐ต Admin (ุงููุฏูุฑ ุงูุฅุฏุงุฑู)**
```
ุตูุงุญูุงุช ุฅุฏุงุฑูุฉ ูุชูุฏูุฉ:
โ manage_users
โ view_users
โ manage_roles
โ view_roles
โ manage_customers
โ view_customers
โ view_branches
โ manage_branches (ูุญุฏูุฏ)
โ view_dashboard
โ change_own_password
โ view_own_branch_only
โ manage_own_branch_users_only
```

---

## โ๏ธ **ููููุฉ ุนูู ูุธุงู ุงูุตูุงุญูุงุช**

### **1. ุงูุชุณูุณู ุงููุฑูู ููุตูุงุญูุงุช**

```
ุงููุฏูุฑ ุงูุนุงู (Super Admin)
โโโ ุตูุงุญูุงุช ุนุงูุฉ (Global Permissions)
โ   โโโ system_admin
โ   โโโ create_global_admin
โ   โโโ view_all_branches
โ   โโโ manage_all_users
โ   โโโ view_all_users
โ
ูุฏูุฑ ุงููุฑุน (Branch Admin)
โโโ ุตูุงุญูุงุช ุงููุฑุน (Branch Permissions)
โ   โโโ view_own_branch_only
โ   โโโ manage_own_branch_users_only
โ   โโโ view_own_branch_users_only
โ   โโโ manage_roles (ูุญุฏูุฏ)
โ
ุงููุณุชุฎุฏู ุงูุนุงุฏู (Regular User)
โโโ ุตูุงุญูุงุช ุฃุณุงุณูุฉ (Basic Permissions)
    โโโ view_own_branch_only
    โโโ view_dashboard
    โโโ change_own_password
```

### **2. ุญุณุงุจ ุตูุงุญูุงุช ุงููุณุชุฎุฏู**

```typescript
function getUserPermissions(userId: number): string[] {
  // 1. ุงูุญุตูู ุนูู ุตูุงุญูุงุช ุงูุฏูุฑ (Role Permissions)
  const rolePermissions = user.role.permissions.map(p => p.permission.name);
  
  // 2. ุงูุญุตูู ุนูู ุงูุชุฌุงูุฒุงุช ุงูุฅูุฌุงุจูุฉ (Granted Overrides)
  const grantedOverrides = user.permissionOverrides
    .filter(override => override.hasPermission === true)
    .map(override => override.permission.name);
  
  // 3. ุงูุญุตูู ุนูู ุงูุชุฌุงูุฒุงุช ุงูุณูุจูุฉ (Revoked Overrides)
  const revokedOverrides = user.permissionOverrides
    .filter(override => override.hasPermission === false)
    .map(override => override.permission.name);
  
  // 4. ุฏูุฌ ุงูุตูุงุญูุงุช ูุทุฑุญ ุงูููุนุฉ
  const allPermissions = [...rolePermissions, ...grantedOverrides];
  return allPermissions.filter(p => !revokedOverrides.includes(p));
}
```

### **3. ุญูุงูุฉ ุงููุตูู (Access Guards)**

#### **ุญูุงูุฉ ุงููุณุงุฑุงุช (Route Guards)**
```typescript
@UseGuards(JwtAuthGuard, BranchAccessGuard)
export class UsersController {
  @Get()
  async getUsers(@Request() req) {
    return this.usersService.findAll(req.user.userId);
  }
}
```

#### **ุญูุงูุฉ ุงููุฑูุน (Branch Access Guard)**
```typescript
export class BranchAccessGuard implements CanActivate {
  canActivate(context: ExecutionContext): boolean {
    const request = context.switchToHttp().getRequest();
    const userPermissions = getUserPermissions(request.user.userId);
    
    // ุชุญูู ูู ุตูุงุญูุงุช ุงููุฑุน
    if (userPermissions.includes('view_all_branches')) {
      return true; // ูุฏูุฑ ุนุงู
    }
    
    return userPermissions.includes('view_own_branch_only'); // ูุณุชุฎุฏู ูุฑุน
  }
}
```

### **4. ููุชุฑุฉ ุงูุจูุงูุงุช ุญุณุจ ุงููุฑุน**

```typescript
async findAll(requestUserId: number) {
  const userPermissions = await getUserPermissions(requestUserId);
  
  if (userPermissions.includes('view_all_users')) {
    // ูุฏูุฑ ุนุงู - ุฅุฑุฌุงุน ุฌููุน ุงููุณุชุฎุฏููู
    return this.prisma.user.findMany();
  }
  
  // ูุณุชุฎุฏู ูุฑุน - ุฅุฑุฌุงุน ูุณุชุฎุฏูู ูุฑุนู ููุท
  const user = await this.prisma.user.findUnique({
    where: { id: requestUserId },
    include: { branch: true }
  });
  
  return this.prisma.user.findMany({
    where: { branchId: user.branchId }
  });
}
```

---

## ๐ญ **ุงูุฃุฏูุงุฑ ุงููุญุฏุฏุฉ ูุณุจูุงู (Role Templates) - 12 ูุงูุจ**

### **๐ ุฃุฏูุงุฑ ุงูุฅุฏุงุฑุฉ (Management Category)**

#### **๐ข Branch Manager (ูุฏูุฑ ุงููุฑุน)**
- **ุงููุตู:** ูุฏูุฑ ุฌููุน ุงูุนูููุงุช ุฏุงุฎู ูุฑุน ูุงุญุฏ
- **ูุทุงู ุงููุฑุน:** ูุฑุน ูุงุญุฏ (Branch)
- **ุงูุตูุงุญูุงุช:**
  - `manage_own_branch_users_only` - ุฅุฏุงุฑุฉ ูุณุชุฎุฏูู ุงููุฑุน
  - `view_own_branch_users_only` - ุนุฑุถ ูุณุชุฎุฏูู ุงููุฑุน
  - `view_own_branch_only` - ุนุฑุถ ุงููุฑุน ุงููุฎุตุต
  - `manage_roles` - ุฅุฏุงุฑุฉ ุงูุฃุฏูุงุฑ
  - `view_roles` - ุนุฑุถ ุงูุฃุฏูุงุฑ
  - `view_dashboard` - ุนุฑุถ ููุญุฉ ุงูุชุญูู

#### **๐ค Assistant Manager (ูุณุงุนุฏ ุงููุฏูุฑ)**
- **ุงููุตู:** ูุณุงุนุฏ ูู ุฅุฏุงุฑุฉ ุงููุฑุน ุจุตูุงุญูุงุช ุฅุฏุงุฑูุฉ ูุญุฏูุฏุฉ
- **ูุทุงู ุงููุฑุน:** ูุฑุน ูุงุญุฏ (Branch)
- **ุงูุตูุงุญูุงุช:**
  - `view_own_branch_only` - ุนุฑุถ ุงููุฑุน ุงููุฎุตุต
  - `view_own_branch_users_only` - ุนุฑุถ ูุณุชุฎุฏูู ุงููุฑุน
  - `view_users` - ุนุฑุถ ุงููุณุชุฎุฏููู
  - `view_dashboard` - ุนุฑุถ ููุญุฉ ุงูุชุญูู

#### **๐ Regional Manager (ูุฏูุฑ ุฅููููู)**
- **ุงููุตู:** ูุฏูุฑ ุนุฏุฉ ูุฑูุน ูู ููุทูุฉ (ูุฏูุฑ ุนุงู ููุท)
- **ูุทุงู ุงููุฑุน:** ุนุงู (Global)
- **ุงูุตูุงุญูุงุช:**
  - `view_all_branches` - ุนุฑุถ ุฌููุน ุงููุฑูุน
  - `manage_branches` - ุฅุฏุงุฑุฉ ุงููุฑูุน
  - `view_all_users` - ุนุฑุถ ุฌููุน ุงููุณุชุฎุฏููู
  - `manage_all_users` - ุฅุฏุงุฑุฉ ุฌููุน ุงููุณุชุฎุฏููู
  - `view_roles` - ุนุฑุถ ุงูุฃุฏูุงุฑ
  - `manage_roles` - ุฅุฏุงุฑุฉ ุงูุฃุฏูุงุฑ
  - `view_dashboard` - ุนุฑุถ ููุญุฉ ุงูุชุญูู

### **โ๏ธ ุฃุฏูุงุฑ ุงูุนูููุงุช (Operations Category)**

#### **๐จโ๐ผ Operations Supervisor (ูุดุฑู ุงูุนูููุงุช)**
- **ุงููุตู:** ูุดุฑู ุนูู ุงูุนูููุงุช ุงูููููุฉ ูู ุงููุฑุน
- **ูุทุงู ุงููุฑุน:** ูุฑุน ูุงุญุฏ (Branch)
- **ุงูุตูุงุญูุงุช:**
  - `view_own_branch_only` - ุนุฑุถ ุงููุฑุน ุงููุฎุตุต
  - `view_own_branch_users_only` - ุนุฑุถ ูุณุชุฎุฏูู ุงููุฑุน
  - `view_dashboard` - ุนุฑุถ ููุญุฉ ุงูุชุญูู

#### **๐ผ Sales Coordinator (ููุณู ุงููุจูุนุงุช)**
- **ุงููุตู:** ููุณู ุฃูุดุทุฉ ุงููุจูุนุงุช ูุนูุงูุงุช ุงูุนููุงุก
- **ูุทุงู ุงููุฑุน:** ูุฑุน ูุงุญุฏ (Branch)
- **ุงูุตูุงุญูุงุช:**
  - `view_own_branch_only` - ุนุฑุถ ุงููุฑุน ุงููุฎุตุต
  - `manage_customers` - ุฅุฏุงุฑุฉ ุงูุนููุงุก
  - `view_customers` - ุนุฑุถ ุงูุนููุงุก
  - `view_dashboard` - ุนุฑุถ ููุญุฉ ุงูุชุญูู

#### **๐ฆ Inventory Manager (ูุฏูุฑ ุงููุฎุฒูู)**
- **ุงููุตู:** ูุฏูุฑ ุงููุฎุฒูู ููุณุชููุงุช ุงููุฎุฒูู
- **ูุทุงู ุงููุฑุน:** ูุฑุน ูุงุญุฏ (Branch)
- **ุงูุตูุงุญูุงุช:**
  - `view_own_branch_only` - ุนุฑุถ ุงููุฑุน ุงููุฎุตุต
  - `view_dashboard` - ุนุฑุถ ููุญุฉ ุงูุชุญูู

#### **๐จโ๐ผ General Employee (ููุธู ุนุงู)**
- **ุงููุตู:** ููุธู ุฃุณุงุณู ุจุตูุงุญูุงุช ูุญุฏูุฏุฉ
- **ูุทุงู ุงููุฑุน:** ูุฑุน ูุงุญุฏ (Branch)
- **ุงูุตูุงุญูุงุช:**
  - `view_own_branch_only` - ุนุฑุถ ุงููุฑุน ุงููุฎุตุต
  - `view_dashboard` - ุนุฑุถ ููุญุฉ ุงูุชุญูู
  - `change_own_password` - ุชุบููุฑ ูููุฉ ุงููุฑูุฑ

### **๐ง ุฃุฏูุงุฑ ุงูุฏุนู (Support Category)**

#### **๐ Customer Service Representative (ููุซู ุฎุฏูุฉ ุงูุนููุงุก)**
- **ุงููุตู:** ูุชุนุงูู ูุน ุงุณุชูุณุงุฑุงุช ุงูุนููุงุก ูุทูุจุงุช ุงูุฏุนู
- **ูุทุงู ุงููุฑุน:** ูุฑุน ูุงุญุฏ (Branch)
- **ุงูุตูุงุญูุงุช:**
  - `view_own_branch_only` - ุนุฑุถ ุงููุฑุน ุงููุฎุตุต
  - `view_customers` - ุนุฑุถ ุงูุนููุงุก
  - `manage_customers` - ุฅุฏุงุฑุฉ ุงูุนููุงุก
  - `view_dashboard` - ุนุฑุถ ููุญุฉ ุงูุชุญูู

#### **๐ง Technical Support Specialist (ุฃุฎุตุงุฆู ุงูุฏุนู ุงูููู)**
- **ุงููุตู:** ููุฏู ุงููุณุงุนุฏุฉ ุงููููุฉ ูุฏุนู ุงููุธุงู
- **ูุทุงู ุงููุฑุน:** ูุฑุน ูุงุญุฏ (Branch)
- **ุงูุตูุงุญูุงุช:**
  - `view_own_branch_only` - ุนุฑุถ ุงููุฑุน ุงููุฎุตุต
  - `view_dashboard` - ุนุฑุถ ููุญุฉ ุงูุชุญูู

### **๐ฐ ุฃุฏูุงุฑ ุงููุงููุฉ (Finance Category)**

#### **๐ณ Branch Accountant (ูุญุงุณุจ ุงููุฑุน)**
- **ุงููุตู:** ูุชุนุงูู ูุน ุงูุณุฌูุงุช ุงููุงููุฉ ูุงููุนุงููุงุช ูููุฑุน
- **ูุทุงู ุงููุฑุน:** ูุฑุน ูุงุญุฏ (Branch)
- **ุงูุตูุงุญูุงุช:**
  - `view_own_branch_only` - ุนุฑุถ ุงููุฑุน ุงููุฎุตุต
  - `view_dashboard` - ุนุฑุถ ููุญุฉ ุงูุชุญูู

#### **๐ฆ Cashier (ุฃููู ุงูุตูุฏูู)**
- **ุงููุตู:** ูุนุงูุฌ ุงููุฏููุนุงุช ููุชุนุงูู ูุน ุงููุนุงููุงุช ุงูููุฏูุฉ
- **ูุทุงู ุงููุฑุน:** ูุฑุน ูุงุญุฏ (Branch)
- **ุงูุตูุงุญูุงุช:**
  - `view_own_branch_only` - ุนุฑุถ ุงููุฑุน ุงููุฎุตุต
  - `view_dashboard` - ุนุฑุถ ููุญุฉ ุงูุชุญูู

#### **๐ Financial Analyst (ูุญูู ูุงูู)**
- **ุงููุตู:** ูุญูู ุงูุจูุงูุงุช ุงููุงููุฉ ูููุดุฆ ุงูุชูุงุฑูุฑ
- **ูุทุงู ุงููุฑุน:** ูุฑุน ูุงุญุฏ (Branch)
- **ุงูุตูุงุญูุงุช:**
  - `view_own_branch_only` - ุนุฑุถ ุงููุฑุน ุงููุฎุตุต
  - `view_dashboard` - ุนุฑุถ ููุญุฉ ุงูุชุญูู

### **๐ ุฅุญุตุงุฆูุงุช ุงูููุงูุจ:**

| ุงููุฆุฉ | ุนุฏุฏ ุงูููุงูุจ | ูุทุงู ุงููุฑุน | ูุณุชูู ุงูุตูุงุญูุงุช |
|------|------------|------------|----------------|
| ุงูุฅุฏุงุฑุฉ (Management) | 3 | 2 ูุฑุน + 1 ุนุงู | ุนุงูู ุฅูู ูุชูุณุท |
| ุงูุนูููุงุช (Operations) | 4 | ุฌููุนูุง ูุฑุน | ูุชูุณุท ุฅูู ุฃุณุงุณู |
| ุงูุฏุนู (Support) | 2 | ุฌููุนูุง ูุฑุน | ุฃุณุงุณู |
| ุงููุงููุฉ (Finance) | 3 | ุฌููุนูุง ูุฑุน | ุฃุณุงุณู |

**ุฅุฌูุงูู:** 12 ูุงูุจ ุฏูุฑ ูุญุฏุฏ ูุณุจูุงู

---

## ๐ **ูุตูููุฉ ุงูุตูุงุญูุงุช ุงูุชูุตูููุฉ**

### **๐ ุฌุฏูู ูุฑุฌุนู ุดุงูู ูุฌููุน ุงูุตูุงุญูุงุช:**

| # | ุงูุตูุงุญูุฉ | ุงูููุน | ุงููุญุฏุฉ | ุงููุตู ุงููุงูู | ุงููุณุชูู ุงููุทููุจ |
|---|---------|------|--------|-------------|-----------------|
| 1 | `system_admin` | ุฅุฏุงุฑู | ุงููุธุงู | ูุตูู ูุงูู ูุฌููุน ูุญุฏุงุช ูุจูุงูุงุช ุงููุธุงู | ูุฏูุฑ ุนุงู |
| 2 | `create_global_admin` | ุฅุฏุงุฑู | ุงููุธุงู | ุฅูุดุงุก ุฃุฏูุงุฑ ุฅุฏุงุฑูุฉ ูุตูุงุญูุงุช ุนุงูุฉ | ูุฏูุฑ ุนุงู |
| 3 | `manage_system_roles` | ุฅุฏุงุฑู | ุงููุธุงู | ุฅุฏุงุฑุฉ ุฃุฏูุงุฑ ุงููุธุงู ุงูุฃุณุงุณูุฉ | ูุฏูุฑ ุนุงู |
| 4 | `view_all_branches` | ุนุฑุถ | ุงููุฑูุน | ุนุฑุถ ุฌููุน ุงููุฑูุน ูู ุงููุธุงู | ูุฏูุฑ ุนุงู |
| 5 | `manage_branches` | ุฅุฏุงุฑุฉ | ุงููุฑูุน | ุฅูุดุงุก ูุชุนุฏูู ูุญุฐู ุงููุฑูุน | ูุฏูุฑ ุนุงู |
| 6 | `view_branches` | ุนุฑุถ | ุงููุฑูุน | ุนุฑุถ ุงููุฑูุน ุงูุนุงูุฉ | ูุฏูุฑ |
| 7 | `view_own_branch_only` | ุนุฑุถ | ุงููุฑูุน | ุนุฑุถ ุงููุฑุน ุงููุฎุตุต ููุท | ุฃุณุงุณู |
| 8 | `view_all_users` | ุนุฑุถ | ุงููุณุชุฎุฏููู | ุนุฑุถ ุฌููุน ูุณุชุฎุฏูู ุงููุธุงู | ูุฏูุฑ ุนุงู |
| 9 | `manage_all_users` | ุฅุฏุงุฑุฉ | ุงููุณุชุฎุฏููู | ุฅุฏุงุฑุฉ ุฌููุน ูุณุชุฎุฏูู ุงููุธุงู | ูุฏูุฑ ุนุงู |
| 10 | `view_own_branch_users_only` | ุนุฑุถ | ุงููุณุชุฎุฏููู | ุนุฑุถ ูุณุชุฎุฏูู ุงููุฑุน ููุท | ูุฑุน |
| 11 | `manage_own_branch_users_only` | ุฅุฏุงุฑุฉ | ุงููุณุชุฎุฏููู | ุฅุฏุงุฑุฉ ูุณุชุฎุฏูู ุงููุฑุน ููุท | ูุฏูุฑ ูุฑุน |
| 12 | `manage_users` | ุฅุฏุงุฑุฉ | ุงููุณุชุฎุฏููู | ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ุนุงูุฉ | ูุฏูุฑ |
| 13 | `view_users` | ุนุฑุถ | ุงููุณุชุฎุฏููู | ุนุฑุถ ุงููุณุชุฎุฏููู | ุฃุณุงุณู |
| 14 | `view_roles` | ุนุฑุถ | ุงูุฃุฏูุงุฑ | ุนุฑุถ ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช | ุฃุณุงุณู |
| 15 | `manage_roles` | ุฅุฏุงุฑุฉ | ุงูุฃุฏูุงุฑ | ุฅูุดุงุก ูุชุนุฏูู ุงูุฃุฏูุงุฑ | ูุฏูุฑ |
| 16 | `view_customers` | ุนุฑุถ | ุงูุนููุงุก | ุนุฑุถ ุจูุงูุงุช ุงูุนููุงุก | ุฃุณุงุณู |
| 17 | `manage_customers` | ุฅุฏุงุฑุฉ | ุงูุนููุงุก | ุฅุฏุงุฑุฉ ุงูุนููุงุก ูุงููุฉ | ูุชูุณุท |
| 18 | `view_dashboard` | ุนุฑุถ | ุงูุนุงู | ุนุฑุถ ููุญุฉ ุงูุชุญูู | ุฃุณุงุณู |
| 19 | `change_own_password` | ุฅุฏุงุฑุฉ | ุงูุญุณุงุจ | ุชุบููุฑ ูููุฉ ุงููุฑูุฑ ุงูุดุฎุตูุฉ | ุฃุณุงุณู |

### **๐ฏ ุชุตููู ุงูุตูุงุญูุงุช ุญุณุจ ุงููุญุฏุฉ:**

#### **๐๏ธ ูุญุฏุฉ ุงููุธุงู (System Module) - 3 ุตูุงุญูุงุช**
- `system_admin` - ุงูุชุญูู ุงููุงูู
- `create_global_admin` - ุฅูุดุงุก ุงูุฅุฏุงุฑุฉ ุงูุนููุง  
- `manage_system_roles` - ุฅุฏุงุฑุฉ ุฃุฏูุงุฑ ุงููุธุงู

#### **๐ข ูุญุฏุฉ ุงููุฑูุน (Branches Module) - 4 ุตูุงุญูุงุช**
- `view_all_branches` - ุนุฑุถ ุฌููุน ุงููุฑูุน
- `manage_branches` - ุฅุฏุงุฑุฉ ุงููุฑูุน
- `view_branches` - ุนุฑุถ ุงููุฑูุน ุงูุนุงูุฉ
- `view_own_branch_only` - ุนุฑุถ ุงููุฑุน ุงููุฎุตุต

#### **๐ฅ ูุญุฏุฉ ุงููุณุชุฎุฏููู (Users Module) - 6 ุตูุงุญูุงุช**
- `view_all_users` - ุนุฑุถ ุฌููุน ุงููุณุชุฎุฏููู
- `manage_all_users` - ุฅุฏุงุฑุฉ ุฌููุน ุงููุณุชุฎุฏููู
- `view_own_branch_users_only` - ุนุฑุถ ูุณุชุฎุฏูู ุงููุฑุน
- `manage_own_branch_users_only` - ุฅุฏุงุฑุฉ ูุณุชุฎุฏูู ุงููุฑุน
- `manage_users` - ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ุนุงูุฉ
- `view_users` - ุนุฑุถ ุงููุณุชุฎุฏููู

#### **๐ญ ูุญุฏุฉ ุงูุฃุฏูุงุฑ (Roles Module) - 2 ุตูุงุญูุงุช**
- `view_roles` - ุนุฑุถ ุงูุฃุฏูุงุฑ
- `manage_roles` - ุฅุฏุงุฑุฉ ุงูุฃุฏูุงุฑ

#### **๐ค ูุญุฏุฉ ุงูุนููุงุก (Customers Module) - 2 ุตูุงุญูุงุช**
- `view_customers` - ุนุฑุถ ุงูุนููุงุก
- `manage_customers` - ุฅุฏุงุฑุฉ ุงูุนููุงุก

#### **๐ ุงููุญุฏุฉ ุงูุนุงูุฉ (General Module) - 2 ุตูุงุญูุงุช**
- `view_dashboard` - ููุญุฉ ุงูุชุญูู
- `change_own_password` - ุฅุฏุงุฑุฉ ุงูุญุณุงุจ

### **๐ ูุณุชููุงุช ุงูุฃูุงู:**

| ุงููุณุชูู | ุนุฏุฏ ุงูุตูุงุญูุงุช | ุงููุตู | ุงููุณุชุฎุฏููู |
|---------|--------------|-------|-------------|
| **ูุฏูุฑ ุนุงู** | 7 ุตูุงุญูุงุช | ุตูุงุญูุงุช ุนุงูุฉ ุนูู ูุณุชูู ุงููุธุงู | Super Admin |
| **ูุฏูุฑ** | 4 ุตูุงุญูุงุช | ุตูุงุญูุงุช ุฅุฏุงุฑูุฉ ูุชูุณุทุฉ | Admin, Regional Manager |
| **ูุฏูุฑ ูุฑุน** | 3 ุตูุงุญูุงุช | ุตูุงุญูุงุช ูุญุฏูุฏุฉ ุจุงููุฑุน | Branch Manager |
| **ูุชูุณุท** | 2 ุตูุงุญูุงุช | ุตูุงุญูุงุช ุชุดุบูููุฉ | Sales Coordinator |
| **ุฃุณุงุณู** | 5 ุตูุงุญูุงุช | ุตูุงุญูุงุช ุฃุณุงุณูุฉ ููุฌููุน | ุฌููุน ุงููุณุชุฎุฏููู |

---

## ๐ **ุขููุงุช ุงูุฃูุงู ูุงูุญูุงูุฉ**

### **1. ููุน ุงูุชุตุนูุฏ ุบูุฑ ุงููุณููุญ (Privilege Escalation Prevention)**
```typescript
// ููุน ุงููุณุชุฎุฏููู ุงูุนุงุฏููู ูู ุฅูุดุงุก ุฃุฏูุงุฑ ุฅุฏุงุฑูุฉ
if (!userPermissions.includes('create_global_admin')) {
  const hasAdminPermissions = permissions.some(p => 
    p.name.includes('system_admin') || 
    p.name.includes('create_global_admin')
  );
  
  if (hasAdminPermissions) {
    throw new ForbiddenException('Cannot assign admin permissions');
  }
}
```

### **2. ุนุฒู ุงูุจูุงูุงุช ุจูู ุงููุฑูุน (Branch Data Isolation)**
```typescript
// ุชุตููุฉ ุงูุจูุงูุงุช ุญุณุจ ุงููุฑุน ุงููุฎุตุต
const whereClause = userPermissions.includes('view_all_branches') 
  ? {} // ูุฏูุฑ ุนุงู - ุนุฑุถ ุงููู
  : { branchId: user.branchId }; // ูุณุชุฎุฏู ูุฑุน - ูุฑุนู ููุท
```

### **3. ุญูุงูุฉ ุงูุฃุฏูุงุฑ ุงููุธุงู (System Role Protection)**
```typescript
if (role.isSystemRole) {
  throw new BadRequestException('Cannot modify system roles');
}
```

---

## ๐ฏ **ุงุณุชุฎุฏุงู ุงููุธุงู ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ**

### **1. ุญูุงูุฉ ุงูููููุงุช (Component Guards)**
```typescript
<SimplePermissionGuard permission="manage_users">
  <Button onClick={createUser}>ุฅุถุงูุฉ ูุณุชุฎุฏู</Button>
</SimplePermissionGuard>
```

### **2. ุญูุงูุฉ ุงูุตูุญุงุช (Page Guards)**
```typescript
<SimplePermissionGuard 
  permission="view_roles" 
  fallback={<UnauthorizedMessage />}
>
  <RolesPage />
</SimplePermissionGuard>
```

### **3. ุงุณุชุนูุงู ุงูุตูุงุญูุงุช (Permission Queries)**
```typescript
const { data: userPermissions } = usePermissions();
const canManageUsers = userPermissions?.includes('manage_users');
```

---

## ๐ **ุฅุญุตุงุฆูุงุช ุงููุธุงู ุงูุญุงูู**

### **๐ ููุฎุต ุดุงูู ูููุธุงู:**

| ุงูุนูุตุฑ | ุงูุนุฏุฏ | ุงูุชูุงุตูู |
|--------|------|---------|
| **ุงูุตูุงุญูุงุช ุงูุฅุฌูุงููุฉ** | 19 | ููุฒุนุฉ ุนูู 6 ูุญุฏุงุช ุฑุฆูุณูุฉ |
| **ุงูุฃุฏูุงุฑ ุงููุธุงููุฉ** | 4 | Super Admin, Admin, Branch Manager, User |
| **ุงูุฃุฏูุงุฑ ุงููุฎุตุตุฉ** | 3 | ุฃุฏูุงุฑ ูุฎุตุตุฉ ุจูุงุณุทุฉ ุงููุณุชุฎุฏููู |
| **ููุงูุจ ุงูุฃุฏูุงุฑ** | 12 | ูุญุฏุฏุฉ ูุณุจูุงู ููุงุจูุฉ ููุชุฎุตูุต |
| **ูุณุชููุงุช ุงูุฃูุงู** | 5 | ูู ูุฏูุฑ ุนุงู ุฅูู ุฃุณุงุณู |
| **ุงููุญุฏุงุช ุงููุบุทุงุฉ** | 6 | ุงููุธุงูุ ุงููุฑูุนุ ุงููุณุชุฎุฏูููุ ุงูุฃุฏูุงุฑุ ุงูุนููุงุกุ ุนุงู |

### **๐ข ุชูุฒูุน ุงูุตูุงุญูุงุช ุญุณุจ ุงูููุน:**

| ููุน ุงูุตูุงุญูุฉ | ุงูุนุฏุฏ | ุงููุณุจุฉ | ุงูุฃูุซูุฉ |
|-------------|------|-------|---------|
| **ุนุฑุถ (View)** | 9 | 47% | view_dashboard, view_users, view_customers |
| **ุฅุฏุงุฑุฉ (Manage)** | 9 | 47% | manage_users, manage_branches, manage_roles |
| **ูุธุงู (System)** | 1 | 6% | system_admin |

### **๐ข ุชูุฒูุน ุงูุตูุงุญูุงุช ุญุณุจ ุงููุทุงู:**

| ุงููุทุงู | ุงูุนุฏุฏ | ุงููุณุจุฉ | ุงููุตู |
|--------|------|-------|-------|
| **ุนุงู (Global)** | 7 | 37% | ุตูุงุญูุงุช ุนูู ูุณุชูู ุงููุธุงู |
| **ูุฑุน (Branch)** | 3 | 16% | ูุญุฏูุฏุฉ ุจุงููุฑุน ุงููุฎุตุต |
| **ูุฎุชูุท (Mixed)** | 9 | 47% | ุชุนุชูุฏ ุนูู ุฏูุฑ ุงููุณุชุฎุฏู |

### **๐ฅ ุชูุฒูุน ุงููุณุชุฎุฏููู ุญุณุจ ุงูุฃุฏูุงุฑ:**

| ุงูุฏูุฑ | ุงูููุน | ุงูุตูุงุญูุงุช | ุงููุทุงู |
|------|------|----------|--------|
| **Super Admin** | ูุธุงูู | 19/19 (100%) | ุนุงู |
| **Admin** | ูุธุงูู | ~12/19 (63%) | ูุฎุชูุท |
| **Branch Manager** | ูุธุงูู | ~10/19 (53%) | ูุฑุน |
| **User** | ูุธุงูู | ~6/19 (32%) | ุฃุณุงุณู |

### **๐ญ ุฅุญุตุงุฆูุงุช ุงูููุงูุจ:**

| ูุฆุฉ ุงูููุงูุจ | ุงูุนุฏุฏ | ุงููุทุงู ุงูุงูุชุฑุงุถู | ูุณุชูู ุงูุตูุงุญูุงุช |
|------------|------|----------------|----------------|
| **ุงูุฅุฏุงุฑุฉ** | 3 | ูุฑุน (66%) + ุนุงู (33%) | ุนุงูู |
| **ุงูุนูููุงุช** | 4 | ูุฑุน (100%) | ูุชูุณุท |
| **ุงูุฏุนู** | 2 | ูุฑุน (100%) | ุฃุณุงุณู |
| **ุงููุงููุฉ** | 3 | ูุฑุน (100%) | ุฃุณุงุณู |

### **๐ ูุคุดุฑุงุช ุงูุฃูุงู:**

| ุงููุคุดุฑ | ุงููููุฉ | ุงููุตู |
|--------|-------|-------|
| **ุงูุตูุงุญูุงุช ุงูุญุณุงุณุฉ** | 3 | system_admin, create_global_admin, manage_system_roles |
| **ุตูุงุญูุงุช ุงููุฑูุน** | 7 | ุชุคุซุฑ ุนูู ุนุฒู ุงูุจูุงูุงุช |
| **ุงูุญูุงูุฉ ูุชุนุฏุฏุฉ ุงููุณุชููุงุช** | โ | JWT + Branch Guards + Permission Checks |
| **ููุน ุงูุชุตุนูุฏ** | โ | ุญูุงูุฉ ูู ุฑูุน ุงูุตูุงุญูุงุช ุบูุฑ ุงููุณููุญ |
| **ุนุฒู ุงูุจูุงูุงุช** | โ | ูุตู ุจูุงูุงุช ุงููุฑูุน |

### **โก ุฃุฏุงุก ุงููุธุงู:**

| ุงูุนูููุฉ | ุงูุทุฑููุฉ | ุงูุฃุฏุงุก |
|---------|--------|--------|
| **ุชุญูู ุงูุตูุงุญูุงุช** | Cache + Database | ุณุฑูุน |
| **ููุชุฑุฉ ุงูุจูุงูุงุช** | Service Layer | ูุชูุณุท |
| **ุญูุงูุฉ ุงููุณุงุฑุงุช** | Guards | ุณุฑูุน |
| **ุนุฒู ุงููุฑูุน** | WHERE Clauses | ุณุฑูุน |

---

## ๐ฏ **ุงูุฎูุงุตุฉ ูุงูุชูุตูุงุช**

### **โ ููุงุท ุงูููุฉ:**
1. **ูุธุงู ุดุงูู** - ูุบุทู ุฌููุน ุฌูุงูุจ ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช
2. **ูุฑููุฉ ุนุงููุฉ** - ููุงูุจ ุฃุฏูุงุฑ ูุงุจูุฉ ููุชุฎุตูุต
3. **ุฃูุงู ูุญูู** - ุนุฒู ุงูุจูุงูุงุช ูุญูุงูุฉ ูุชุนุฏุฏุฉ ุงููุณุชููุงุช
4. **ุณูููุฉ ุงูุฅุฏุงุฑุฉ** - ูุงุฌูุฉ ุจุณูุทุฉ ูููุงูุจ ูุญุฏุฏุฉ ูุณุจูุงู
5. **ูุงุจููุฉ ุงูุชูุณุน** - ูููู ุฅุถุงูุฉ ุตูุงุญูุงุช ููุญุฏุงุช ุฌุฏูุฏุฉ

### **๐ง ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ:**
1. **ุชุฏููู ุงูุตูุงุญูุงุช** - ุชุณุฌูู ุฌููุน ุงูุนูููุงุช ุงูุญุณุงุณุฉ
2. **ุตูุงุญูุงุช ูุคูุชุฉ** - ููุญ ุตูุงุญูุงุช ููุชุฑุฉ ูุญุฏุฏุฉ
3. **ุชูุจููุงุช ุงูุฃูุงู** - ุฅุดุนุงุฑุงุช ุนูุฏ ุชุบููุฑ ุงูุตูุงุญูุงุช
4. **ุชูุงุฑูุฑ ุงูุงุณุชุฎุฏุงู** - ุชุญููู ุงุณุชุฎุฏุงู ุงูุตูุงุญูุงุช
5. **ุงููุณุฎ ุงูุงุญุชูุงุทู** - ุญูุธ ุชููููุงุช ุงูุฃุฏูุงุฑ

### **๐ ูููุฐุฌ ุงูุงุณุชุฎุฏุงู ุงููุซุงูู:**
```
ูุคุณุณุฉ ูุชุนุฏุฏุฉ ุงููุฑูุน
โโโ ูุฏูุฑ ุนุงู (1) - ุฌููุน ุงูุตูุงุญูุงุช
โโโ ูุฏุฑุงุก ุงููุฑูุน (5) - ุตูุงุญูุงุช ุงููุฑุน
โโโ ููุธูู ุงูุฅุฏุงุฑุฉ (10) - ุตูุงุญูุงุช ูุชูุณุทุฉ
โโโ ููุธููู ุนุงุฏููู (50) - ุตูุงุญูุงุช ุฃุณุงุณูุฉ
```

ูุฐุง ุงููุธุงู ูููุฑ ุฅุฏุงุฑุฉ ุดุงููุฉ ููุฑูุฉ ููุตูุงุญูุงุช ูุน ุถูุงู ุงูุฃูุงู ูุงูุนุฒู ุจูู ุงููุฑูุน! ๐